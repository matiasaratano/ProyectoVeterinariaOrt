CREATE DATABASE VETERINARIA;
USE VETERINARIA

CREATE TABLE CLIENTES
(Dni INT NOT NULL PRIMARY KEY,
Nombre varchar(50) NOT NULL,
Apellido varchar(50) NOT NULL,
Email varchar(20),
Telefono varchar(20)
)

INSERT INTO CLIENTES(Dni,Nombre,Apellido,Email,Telefono)values(22556890,'GOMEZ','ESTEBAN','GESTEBAN@GMAIL.COM','6789-9876'),(32678654,'LOPEZ','MARIA','MLOPEZ@GMAIL.COM','667-9876')

CREATE TABLE MASCOTAS
(
    Id_Mascota INT NOT NULL IDENTITY PRIMARY KEY,
    Nombre VARCHAR(50) NOT NULL,
    Tipo VARCHAR(50),
    Edad int
)
INSERT INTO MASCOTAS(NOMBRE,TIPO,EDAD)VALUES('COCO','PERRO',6),('CACIQUE','GATO',8),('SULTAN','PERRO',12)
SELECT * FROM MASCOTAS

CREATE TABLE TURNOS(
    Id int IDENTITY PRIMARY KEY,
    Dia VARCHAR(8),
    Hora VARCHAR(2)
)
INSERT TURNOS(DIA,HORA)VALUES('20230529','8'),('20230529','9'),('20230529','10'),('20230529','11'),('20230529','12')
SELECT * FROM TURNOS


CREATE TABLE VETERINARIOS
(
Matricula int IDENTITY PRIMARY KEY,
Nombre VARCHAR(50),
Apellido VARCHAR(50)
)
INSERT INTO VETERINARIOS(Nombre,Apellido)VALUES('MARTINEZ','JUAN'),('GOMEZ','AGUSITIN'),('GODOY','MONICA')
SELECT * FROM VETERINARIOS

CREATE TABLE RESERVAS_TURNOS
        (
            Id_Turno INT NOT NULL ,
            Id_Mascota INT NOT NULL,
            Dni INT NOT NULL,
            Matricula INT NOT NULL,
        )

ALTER TABLE RESERVAS_TURNOS	ADD CONSTRAINT FK_Turnos FOREIGN KEY (Id_Turno) REFERENCES TURNOS(Id);
ALTER TABLE RESERVAS_TURNOS	ADD CONSTRAINT FK_clientes FOREIGN KEY (Dni) REFERENCES CLIENTES(Dni);
ALTER TABLE RESERVAS_TURNOS	ADD CONSTRAINT FK_Mascotas FOREIGN KEY (Id_Mascota) REFERENCES MASCOTAS(Id_Mascota);
ALTER TABLE RESERVAS_TURNOS	ADD CONSTRAINT FK_Matriculas FOREIGN KEY (Matricula) REFERENCES VETERINARIOS(Matricula);

INSERT INTO RESERVAS_TURNOS(Id_Turno,Id_Mascota,Dni,Matricula)VALUES(1,1,22556890,1)
INSERT INTO RESERVAS_TURNOS(Id_Turno,Id_Mascota,Dni,Matricula)VALUES(4,2,32678654,1)

SELECT * FROM RESERVAS_TURNOS
--DELETE  FROM RESERVAS_TURNOS WHERE Id_Turno=1

--TURNOS DISPONIBLES
SELECT T.DIA,T.HORA 
FROM TURNOS T LEFT JOIN RESERVAS_TURNOS R ON T.ID=R.Id_Turno
WHERE R.Id_Turno IS NULL

--LISTADO DE RESERVAS
SELECT 
case DATEPART(dw,T.DIA) when 2 then 'Lunes' 
when 3 then 'Martes' when 4 then 'Miércoles' 
when 5 then 'Jueves' when 6 then 'Viernes' 
when 7 then 'Sábado' when 1 then 'Domingo' end AS DIA
, T.DIA FECHA,T.HORA
,M.Nombre,M.Tipo
,C.Apellido,C.Nombre,C.Dni 
FROM TURNOS T INNER JOIN RESERVAS_TURNOS R ON T.ID=R.Id_Turno
INNER JOIN CLIENTES C ON R.Dni=C.Dni
INNER JOIN MASCOTAS M ON R.Id_Mascota= M.Id_Mascota
WHERE  T.DIA Between 20230529 AND 20230530
